<div class="container">
  <app-spinner [show]="showSpinner"></app-spinner>

    <div class="vacants-container">

      <div class="sorting-preference-container" *ngIf="user">
        <span>Preferencia de ordenamiento:&nbsp;</span>
        <ol>
          <li *ngFor="let sort of sorts">{{sort.value}}</li>
        </ol>
      </div>

      <mat-accordion class="only-expanse-panel" *ngIf="user">
        <mat-expansion-panel class="expanse-panel"
          (opened)="panelOpenState = true"
          (closed)="panelOpenState = false"
          togglePosition="after">
          <mat-expansion-panel-header class="expanse-panel-header">
            <mat-panel-title class="expanse-panel-title">
              <mat-icon>filter_alt</mat-icon>
              <span>Filtros:&nbsp;</span>
            </mat-panel-title>
          </mat-expansion-panel-header>

          <div class="filter-container">
            <ol class="filter-block">
              <li *ngFor="let corp of user.corps" class="item-list">
                {{corp.desc}}
                <ol>
                  <li *ngFor="let position of corp.positions" class="item-list">
                    <label class="container-checkbox">{{position.desc}}
                      <input type="checkbox" [(ngModel)]="position.checked" (change)="onFilter(position)"/>
                      <span class="checkmark"></span>
                  </label>
                  </li>
                </ol>
              </li>
            </ol>
            <ol class="filter-block">
              <li class="item-list">Provincias
                <ol>
                  <li *ngFor="let state of states" class="item-list">
                    <label class="container-checkbox">{{state.desc}}
                      <input type="checkbox" [(ngModel)]="state.checked" (change)="onFilter(state)"/>
                      <span class="checkmark"></span>
                    </label>
                  </li>
                </ol>
              </li>
            </ol>
          </div>
        </mat-expansion-panel>
    </mat-accordion>
    
    <mat-toolbar class="datatable-toolbar" *ngIf="user">
      <ul>
        <li matTooltip="Acting Teacher {{version}}" [matTooltipShowDelay]="2000" matTooltipPosition="right">
          <a (click)="search()" class="navButton">
              <mat-icon>refresh</mat-icon>
          </a>
        </li>
        <li matTooltip="Acting Teacher {{version}}" [matTooltipShowDelay]="2000" matTooltipPosition="right">
          <span class="separator"></span>
        </li>
        <li matTooltip="Acting Teacher {{version}}" [matTooltipShowDelay]="2000" matTooltipPosition="right">
          <a (click)="save($event)" class="navButton" [ngClass]="showSave ? '' : 'disabled'">
              <mat-icon>save</mat-icon>
          </a>
        </li>
        <li matTooltip="Acting Teacher {{version}}" [matTooltipShowDelay]="2000" matTooltipPosition="right">
          <span class="separator"></span>
        </li>
        <li matTooltip="Acting Teacher {{version}}" [matTooltipShowDelay]="2000" matTooltipPosition="right">
          <a (click)="showDistance ? route($event) : ''" class="navButton" [ngClass]="showDistance ? '' : 'disabled'">
              <mat-icon>room</mat-icon>
          </a>
        </li>
      </ul>
    </mat-toolbar>

    <ngx-datatable
      #vacantsTable
      class="material expandable" 
      [rows]="vacants.rows"
      [sortType]="SortType.multi"
      [columnMode]="ColumnMode.flex"
      [footerHeight]="50"
      [rowHeight]="48"
      [scrollbarV]="false"
      [loadingIndicator]="isLoading"
      [virtualization]="true"
      [limit]="10"
      [externalSorting]="true"
      (sort)="onSort($event)"
      (resize)="onColumnResize($event)">

      <ngx-datatable-row-detail [rowHeight]="100" (toggle)="onDetailToggle($event)" >
        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
          <div [class]="row.index % 2 === 0 ? 'datatable-row-odd' : 'datatable-row-even'" class="row-detail">
            <div class="detail-left">
              <div class="detail-row-title">Codigo:</div>
              <div class="detail-row-content">{{row.idPlaza}}</div>
            </div>
            <div class="detail-left-center">
              <div class="detail-row-title">Centro:</div>
              <div class="detail-row-content">
                <div>{{row.school.name}}</div>
                <div><span>{{row.localidad}}</span>&nbsp;<span>({{row.provincia}})</span>,&nbsp;<span>{{row.school.address}}</span></div>
              </div>
            </div>
            <div class="detail-right-center">
              <div class="detail-row-title">Vacante:</div>
              <div class="detail-row-content">
                <div><span>Puesto:&nbsp;</span><span>{{row.jobOpening.desc}}</span></div>
                <div><span>Plazas:&nbsp;</span><span>{{row.numPla}}</span></div>
                <div><span>Tipo:&nbsp;</span><span>{{row.tipo}}</span></div>
              </div>
            </div>
            <div class="detail-right">
              <div class="detail-row-title">Observaciones:</div>
              <div class="detail-row-content">
                <div style="height: 48px; overflow-y: auto;">{{row.observaciones}}</div>
              </div>
            </div>
          </div>
        </ng-template>
      </ngx-datatable-row-detail>

      <ngx-datatable-column
        [flexGrow]=.3
        [resizeable]="false"
        [sortable]="false"
        [draggable]="false">

        <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
          <a class="row"
            href="javascript:void(0)"
            [class.datatable-icon-right]="!expanded"
            [class.datatable-icon-up]="expanded"
            title="Expand/Collapse Row"
            (click)="toggleExpandRow(row)">
          </a>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[0].value}}"
        prop="{{columns[0].key}}"
        [flexGrow]=1.4
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['school']['name']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="row.index"
        prop="row.index"
        [flexGrow]=1
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['index']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[1].value}}"
        prop="{{columns[1].key}}"
        [flexGrow]=1
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['provincia']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[2].value}}"
        prop="{{columns[2].key}}"
        [flexGrow]=1.3
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['localidad']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[3].value}}"
        prop="{{columns[3].key}}"
        [flexGrow]=1.3
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['jobOpening']['desc']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[4].value}}"
        prop="{{columns[4].key}}"
        [flexGrow]=.9
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['participacion'] == 'O' ? 'Obligatoria' : 'Voluntaria'}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[5].value}}"
        prop="{{columns[5].key}}"
        [flexGrow]=1
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['fFinAus']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[6].value}}"
        prop="{{columns[6].key}}"
        [flexGrow]=.9
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['distancia']}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column
        name="{{columns[7].value}}"
        prop="{{columns[7].key}}"
        [flexGrow]=.9
        [resizeable]="true"
        [sortable]="true"
        [draggable]="true"
        headerClass="move"
        cellClass="ellipsis">

        <ng-template let-row="row" ngx-datatable-cell-template>
          {{row['tiempo']}}
        </ng-template>
      </ngx-datatable-column>

    </ngx-datatable>
  </div>
</div>


